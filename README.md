# TARS 机器人 | 星际穿越

本项目灵感源自电影《星际穿越》中富有情感表达的智能机器人 TARS，旨在以低成本开源硬件为基础，构建一款具备自然语音交互、表情显示、动作反馈的桌面仿生机器人。它不仅是一项嵌入式与 AI 融合的综合实践项目，也是一个探索"人机共情"边界的作品。

📦 **项目目标**：构建一个结构紧凑、能量高效、反应灵敏，能够陪伴用户专注、对话和互动的具生命感的桌面搭子机器人。

## ✨ 项目主要特点
### 🔧 1. 嵌入式终端系统（ESP32-S3）

📍 部署于机器人主控板（ESP32-S3），运行固件，承担输入感知、显示反馈、网络通讯、执行指令等功能。

**主要功能：**
- OLED 屏幕显示（状态/表情）
- SG90 舵机控制
- 小智AI协议 / HTTP / WebSocket 通信
- 本地动作 & 按键响应
- 电池 + 升压供电

### 🏗️ 2. 机械结构系统（SolidWorks建模）

📍 机器人实体结构，封装全部电子部件，并支持机械运动。

**设计特点：**
- 壳体 + 舵机仓
- OLED窗口 / 开关位
- 电池舱 + 理线卡扣
- TARS风格外观设计

### 🧠 3. 后端对话服务（可选自建 Flask）

📍 为设备提供语言理解、语音合成、动作策略等 API 服务。

> **注意**：嵌入式一开始使用虾哥的小智AI服务器，后端同步开发此模块，方便后续接入。
**对话处理流程：**

```
[语音输入]
   │
   ▼
┌─────────────┐
│   STT 模块  │ ⬅───── 音频输入（上传或流式）
└─────────────┘
   │ Text
   ▼
┌─────────────┐
│   LLM 模块  │ ⬅───── 支持多个模型（OpenAI、Qwen、DeepSeek）
└─────────────┘
   │ Reply Text
   ▼
┌─────────────┐
│   TTS 模块  │ ⬅───── 自定义语音包模型支持（训练后部署）
└─────────────┘
   │ Audio URL
   ▼
[下发到设备]
     └─▶ WebSocket → display/motion/speak 命令

[设备 → 后端]
     └─▶ /device/event → 按键、动作完成、状态上报
```
## 📡 通信与数据流（设备 ↔ 后端 + 小智AI）
支持两种工作模式：
- ✅ 模式 A：连接小智AI（虾哥服务器） → 快速上线，立即体验
- ✅ 模式 B：连接自建 Flask 后端 → 可定制，支持自训练语音包、本地部署
### 🟢 模式 A：连接小智AI 云服务（默认启用）

```
[ESP32设备]
   └─▶ 连接 Wi-Fi
   └─▶ 向小智AI服务器发起握手（HTTP + WebSocket）
   └─▶ 发送录音（麦克风输入）
        │
        ▼
  小智AI服务器（虾哥）
   └─▶ 完成 STT → LLM → TTS
   └─▶ 返回文字 + 音频URL + 动作指令
   └─▶ ESP32 显示/播放/执行动作
```
### 🟡 模式 B：连接自建 Flask 后端（可联调/自定义模型）

```
[ESP32设备]
   └─▶ 连接 Wi-Fi
   └─▶ WebSocket /device/ws 连接到 Flask
   └─▶ 通过按钮或传感器触发"交互事件"
        │
        ▼
  Flask 后端服务
   ├─ /chat/turn（转发到 STT → LLM → TTS）
   ├─ 模型适配器层（可选 openai/qwen/edge-tts/自训练语音）
   ├─ /tts（生成自定义语音包音频）
   ├─ WebSocket 向设备推送 display / motion / speak
   └─ /device/event 接收事件上报（按钮/动作完成/心跳等）
```

## 🧱 项目架构图
```
┌────────────────────────────────────────────────────────────┐
│                    TARS Bot 系统架构                        │
└────────────────────────────────────────────────────────────┘

                ┌─────────────────────────────┐
                │       ESP32-S3 主控固件       │
                │─────────────────────────────│
                │ • OLED 屏幕显示（状态/表情） │
                │ • SG90 舵机控制               │
                │ • 小智AI协议 / HTTP / WS     │
                │ • 本地动作 & 按键响应         │
                │ • 电池 + 升压供电             │
                └─────────────────────────────┘
                            │
          ┌─────────────────┼─────────────────┐
          ▼                                     ▼
🟢 连接小智AI服务器                   🟡 自建 Flask 后端服务（Docker）
（默认接入体验）                     （自定义三段式 + 本地语音包）
          │                                     │
    ┌─────────────┐                     ┌────────────────────┐
    │ 小智AI 云服务 │                     │ Flask 后端框架（WS+REST）│
    │─────────────│                     │────────────────────│
    │ • 麦克风音频 → STT               │ • /chat/turn         │
    │ • LLM 语义理解                   │ • /tts（自定义 voice）│
    │ • 合成语音 TTS                  │ • /device/ws（推送）  │
    │ • 返回文字 + URL + 动作         │ • /device/event       │
    └─────────────┘                     └────────────────────┘
                                                 │
                    ┌────────────────────────────┼────────────────────────────┐
                    ▼                            ▼                            ▼
         🔌 模型适配层             📦 自训练语音包引擎             📄 Web 监控面板（可选）
        （支持任意 LLM / TTS）      （如 so-vits-svc / Bark）        （查看事件日志 / 模拟操作）

                                ↓
                     ┌────────────────────┐
                     │ 机械结构系统（TARS风）│
                     │ • 壳体 + 舵机仓        │
                     │ • OLED窗口 / 开关位    │
                     │ • 电池舱 + 理线卡扣     │
                     └────────────────────┘
```

## 📁 项目结构

```
open-tras/
├── 1.Hardware/          # 硬件设计文件
├── 2.Firmware/          # ESP32-S3 固件代码
├── 3.Software/          # 后端服务代码
├── 4.CAD-Model/         # 3D建模文件
├── 5.Docs/              # 项目文档
└── README.md            # 项目说明
```

## 🚀 开发规范

### 📋 分支管理策略

本项目采用功能分支开发模式，请严格按照以下分支规范进行开发：

#### 主要分支
- **`main`** - 主分支，稳定版本，受保护
- **`develop`** - 开发分支，集成测试分支

#### 功能分支
- **`hardware`** - 硬件设计相关开发
- **`firmware`** - ESP32-S3固件开发
- **`backend`** - 后端服务开发
- **`mechanical`** - 机械结构和3D建模
- **`docs`** - 文档编写和维护

### 🔄 开发流程

1. **创建功能分支**
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b feature/your-feature-name
   ```

2. **选择对应分支进行开发**
   - 硬件相关: `git checkout hardware`
   - 固件开发: `git checkout firmware`
   - 后端开发: `git checkout backend`
   - 机械设计: `git checkout mechanical`
   - 文档编写: `git checkout docs`

3. **提交代码**
   ```bash
   git add .
   git commit -m "feat: 添加功能描述"
   git push origin your-branch-name
   ```

4. **创建Pull Request**
   - 目标分支: `develop`
   - 请求代码审查
   - 通过测试后合并

### 📝 Commit 规范

采用 [Conventional Commits](https://www.conventionalcommits.org/) 规范：

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

#### Type 类型
- **feat**: 新功能
- **fix**: 修复bug
- **docs**: 文档更新
- **style**: 代码格式调整
- **refactor**: 代码重构
- **test**: 测试相关
- **chore**: 构建过程或辅助工具的变动

#### Scope 范围
- **hardware**: 硬件相关
- **firmware**: 固件相关
- **backend**: 后端相关
- **mechanical**: 机械设计相关
- **docs**: 文档相关

#### 示例
```bash
feat(firmware): 添加OLED显示功能
fix(backend): 修复WebSocket连接问题
docs(hardware): 更新PCB设计文档
```

### 🛠️ 开发环境要求

#### 硬件开发
- **EDA软件**: KiCad 6.0+ 或 Altium Designer
- **仿真工具**: LTSpice

#### 固件开发
- **IDE**: PlatformIO (推荐) 或 Arduino IDE
- **编译器**: ESP-IDF 4.4+
- **调试工具**: ESP32-S3 开发板

#### 后端开发
- **Python**: 3.8+
- **框架**: Flask + Flask-SocketIO
- **容器**: Docker + Docker Compose

#### 机械设计
- **建模软件**: SolidWorks 2022+
- **渲染**: KeyShot 或 SolidWorks Visualize
- **切片**: Cura 或 PrusaSlicer

### 📋 代码审查要求

1. **所有代码必须经过审查才能合并到 `develop` 分支**
2. **至少需要1人审查通过**
3. **确保代码符合项目编码规范**
4. **必须通过所有自动化测试**
5. **更新相关文档**

### 🚨 注意事项

- **禁止直接向 `main` 分支推送代码**
- **每个功能分支专注于单一功能开发**
- **及时同步 `develop` 分支的最新代码**
- **提交前确保代码能够正常编译和运行**
- **遵循各模块的具体开发规范**
